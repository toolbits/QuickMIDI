#include <Threads.h>#define				ZeroValue				(long)0#define				ZeroPointer				(long)0#define				ZeroHandle				(long)0#define				EventSleep				1#define				MacOSEventMask			0x01000000//GlobalRoutinesvoid				MainEventAction			(void);void				SetApplicationQuit		(Boolean);//StaticRoutinesstatic	void		IdleAction				(void);static	void		MouseDownAction			(EventRecord*);static	void		KeyDownAction			(EventRecord*);static	void		UpdateAction			(EventRecord*);static	void		MacOSAction				(EventRecord*);static	void		DiskAction				(EventRecord*);static	void		ResumeAction			(EventRecord*);static	void		SuspendAction			(EventRecord*);//ExternRoutinesextern	void		MenuAction				(long);extern	CWindowPtr	GetMainWindow			(void);extern	void		VisualMainGraphic		(void);extern	void		IdleMidiStatus			(void);//StsticMemoriesstatic	Boolean		ApplicationQuit;void MainEventAction(void){	EventRecord			Event;		while(ApplicationQuit == false){		YieldToAnyThread();											//Thread Entry				WaitNextEvent(everyEvent,&Event,EventSleep,ZeroHandle);		switch(Event.what){			case nullEvent:				IdleAction();				break;			case mouseDown:				MouseDownAction(&Event);				break;			case mouseUp:				break;			case keyDown:				KeyDownAction(&Event);				break;			case keyUp:				break;			case autoKey:				break;			case updateEvt:				UpdateAction(&Event);				break;			case activateEvt:				break;			case osEvt:				MacOSAction(&Event);				break;			case kHighLevelEvent:				AEProcessAppleEvent(&Event);				break;			case diskEvt:				DiskAction(&Event);				break;			case networkEvt:				break;			case driverEvt:				break;			default:				break;		}	}	return;}/*MainEventAction*/void SetApplicationQuit(Boolean ActiveValue){	ApplicationQuit = ActiveValue;	return;}/*SetApplicationQuit*/static void IdleAction(void){	IdleMidiStatus();	return;}/*IdleAction*/static void MouseDownAction(EventRecord *EventPtr){		CWindowPtr			ActionWindow;		switch(FindWindow(EventPtr->where,(WindowPtr*)&ActionWindow)){		case inDesk:			break;		case inMenuBar:			MenuAction(MenuSelect(EventPtr->where));			break;		case inSysWindow:			SystemClick(EventPtr,(WindowPtr)ActionWindow);			break;		case inContent:			if(ActionWindow == (CWindowPtr)FrontWindow()){			}			else SelectWindow((WindowPtr)ActionWindow);			break;		case inDrag:			DragWindow((WindowPtr)ActionWindow,EventPtr->where,&(qd.screenBits.bounds));			break;		case inGrow:			break;		case inGoAway:			if((TrackGoAway((WindowPtr)ActionWindow,EventPtr->where)) == true) HideWindow((WindowPtr)GetMainWindow());			break;		case inZoomIn:		case inZoomOut:			break;		default:			break;	}	return;}/*MouseDownAction*/static void KeyDownAction(EventRecord *EventPtr){	if((EventPtr->modifiers & cmdKey) != 0) MenuAction(MenuKey(EventPtr->message & charCodeMask));	return;}/*KeyDownAction*/static void UpdateAction(EventRecord *EventPtr){	CWindowPtr		ActionWindow;	CGrafPtr		SaveGPort;		ActionWindow = (CWindowPtr)EventPtr->message;	GetPort((GrafPtr*)&SaveGPort);	SetPort((GrafPtr)ActionWindow);	BeginUpdate((WindowPtr)ActionWindow);	if(ActionWindow == GetMainWindow()) VisualMainGraphic();	EndUpdate((WindowPtr)ActionWindow);	SetPort((GrafPtr)SaveGPort);	return;}/*UpdateAction*/static void MacOSAction(EventRecord *EventPtr){	switch((unsigned long)(EventPtr->message & osEvtMessageMask)/MacOSEventMask){		case suspendResumeMessage:			if(EventPtr->message & resumeFlag) ResumeAction(EventPtr);			else SuspendAction(EventPtr);			break;		case mouseMovedMessage:			break;		default:			break;	}	return;}/*MacOSAction*/static void DiskAction(EventRecord *EventPtr){	Point			DiskPoint;		if(HiWord(EventPtr->message) != noErr){		SetPt(&DiskPoint,100,100);		DIBadMount(DiskPoint,EventPtr->message);	}	return;}/*DiskAction*/static void ResumeAction(EventRecord *EventPtr){		SetCursor(&qd.arrow);	return;}/*ResumeAction*/static void SuspendAction(EventRecord *EventPtr){	SetCursor(&qd.arrow);	return;}/*SuspendAction*/